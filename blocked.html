<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Blocked - ATAV Safe Browsing</title>
    <link rel="stylesheet" href="blocked.css">
</head>
<body>
    <div class="container" id="blockContainer">
        <h1><span class="danger-icon"></span> Site Blocked: Potentially Dangerous</h1>
        <p>The website you attempted to access has been flagged as potentially dangerous by <strong>ATAV Safe Browsing</strong>.</p>
        
        <div class="details">
            <p><strong>Blocked Host:</strong> <span id="host">N/A</span></p>
            <p><strong>Assessed Risk:</strong> <span id="risk">N/A</span></p>
            <p><strong>Category:</strong> <span id="category">N/A</span></p>
            <p><strong>Original URL:</strong> <span id="originalUrlDisplay">N/A</span></p>
        </div>
        
        <p>We strongly advise against proceeding to this site. Your security is important.</p>
        
        <div class="actions">
            <button id="goBackButton" title="Go to the previous page or a new tab">Go Back Safely</button>
            <button id="continueButton" title="Proceed to the blocked site (not recommended)">Continue Anyway</button>
            <button id="stopCloseButton" title="Stop loading and close this page immediately">Stop & Close</button>
        </div>
        <p class="footer-note">If you believe this is a mistake, you can report it using the ATAV Safe Browsing extension icon in your browser toolbar.</p>
    </div>
    <div id="frameContainer" style="display:none; width:100%; height:90vh;">
        <!-- The blocked site will load here if "Continue" is clicked. -->
        <div style="display: flex; justify-content: flex-end; background: #f8f8f8; padding: 8px;">
            <button id="closeFrameButton" style="background:red;color:#fff; border:none; padding: 8px 12px; cursor:pointer;">Stop & Close</button>
            <button id="backToBlockPage" style="margin-left:10px; background:#333;color:#fff;border:none;padding:8px 12px;cursor:pointer;">Return to Warning</button>
        </div>
        <iframe id="blockedIframe" src="" style="width:100%; height:85vh; border:none;"></iframe>
    </div>
    <script>
        // Helper to get the original URL (for demo, update this as per actual extension logic)
        function getOriginalUrl() {
            return sessionStorage.getItem('blockedUrl') || '';
        }

        // "Continue" loads the blocked site within an iframe in this page
        document.getElementById('continueButton').addEventListener('click', function() {
            var originalUrl = document.getElementById('originalUrlDisplay').textContent;
            if (!/^https?:\/\//.test(originalUrl)) {
                alert('Invalid or missing original URL.');
                return;
            }
            document.getElementById('blockContainer').style.display = 'none';
            document.getElementById('frameContainer').style.display = 'block';
            document.getElementById('blockedIframe').src = originalUrl;
        });

        // "Stop & Close" tries to stop any loading and closes the tab
        function stopAndClose() {
            if (typeof window.stop === 'function') window.stop();
            window.close();
        }
        document.getElementById('stopCloseButton').addEventListener('click', stopAndClose);
        document.getElementById('closeFrameButton').addEventListener('click', stopAndClose);

        // "Return to Warning" goes back to blocked warning view, stops iframe
        document.getElementById('backToBlockPage').addEventListener('click', function() {
            document.getElementById('blockedIframe').src = 'about:blank';
            document.getElementById('frameContainer').style.display = 'none';
            document.getElementById('blockContainer').style.display = 'block';
        });

        // Optionally, set the "originalUrlDisplay" from sessionStorage or other source if needed
        window.addEventListener('DOMContentLoaded', function() {
            var blockedUrl = getOriginalUrl();
            if (blockedUrl) {
                document.getElementById('originalUrlDisplay').textContent = blockedUrl;
            }
        });
    </script>
    <script src="blocked.js"></script>
</body>
</html>
